<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Velgram Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>
<body class="bg-[#0f172a] text-slate-200 min-h-screen p-4 md:p-10">

    <div class="max-w-6xl mx-auto">
        <header class="flex justify-between items-center mb-10 border-b border-white/10 pb-5">
            <h1 class="text-2xl font-black text-blue-500 uppercase tracking-tighter italic">Velgram <span class="text-white">Admin</span></h1>
            <button onclick="location.reload()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-sm font-bold transition">Refresh Data</button>
        </header>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <div class="bg-slate-800/50 border border-white/5 p-6 rounded-2xl">
                <p class="text-slate-500 text-xs font-bold uppercase">Total Users</p>
                <h2 id="total-users" class="text-4xl font-black mt-2">--</h2>
            </div>
            <div class="bg-slate-800/50 border border-white/5 p-6 rounded-2xl">
                <p class="text-slate-500 text-xs font-bold uppercase">Active Channels</p>
                <h2 id="total-channels" class="text-4xl font-black mt-2 text-emerald-400">--</h2>
            </div>
            <div class="bg-slate-800/50 border border-white/5 p-6 rounded-2xl">
                <p class="text-slate-500 text-xs font-bold uppercase">Live Campaigns</p>
                <h2 id="total-ads" class="text-4xl font-black mt-2 text-blue-400">--</h2>
            </div>
        </div>

        <!-- Point Control Section -->
        <div class="bg-slate-800/50 border border-white/5 p-8 rounded-3xl">
            <h3 class="text-lg font-bold mb-6 flex items-center gap-2"><i class='bx bxs-edit-alt text-blue-500'></i> Manual Point Control</h3>
            <div class="flex flex-wrap gap-4">
                <input id="target-id" type="text" placeholder="Telegram User ID" class="flex-1 min-w-[250px] bg-slate-900 border border-white/10 p-4 rounded-xl outline-none focus:border-blue-500 transition">
                <input id="points-amount" type="number" placeholder="Points amount" class="w-full md:w-40 bg-slate-900 border border-white/10 p-4 rounded-xl outline-none focus:border-blue-500">
                <button onclick="updatePoints()" class="w-full md:w-auto bg-white text-black px-8 py-4 rounded-xl font-black hover:bg-blue-500 hover:text-white transition">Apply Points</button>
            </div>
        </div>
    </div>

    <script>
        // Password Protection logic
        const adminPass = prompt("Admin Security Key Required:");
        
        async function loadStats() {
            const res = await fetch(`/api/admin/stats?pass=${adminPass}`);
            const data = await res.json();
            
            if (data.error) {
                alert("Unauthorized Access!");
                document.body.innerHTML = "<h1 class='text-center mt-20 text-red-500 font-bold'>403 Forbidden: Invalid Security Key</h1>";
                return;
            }

            document.getElementById('total-users').innerText = data.userCount;
            document.getElementById('total-channels').innerText = data.channelCount;
            document.getElementById('total-ads').innerText = data.adCount;
        }

        async function updatePoints() {
            const userId = document.getElementById('target-id').value;
            const points = document.getElementById('points-amount').value;
            if(!userId || !points) return alert("Fields are empty!");

            const res = await fetch('/api/admin/update-points', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ pass: adminPass, targetId: userId, points: points })
            });
            const result = await res.json();
            alert(result.message);
            loadStats();
        }

        if(adminPass) loadStats();
    </script>
</body>
</html>
